[gd_scene load_steps=33 format=3 uid="uid://ca53pcskbfcnn"]

[ext_resource type="Script" uid="uid://dgigh5hp7pais" path="res://Prefabs/Player/Scripts/player_3d.gd" id="1_nld07"]
[ext_resource type="PackedScene" uid="uid://bgk2h58i8b82w" path="res://Prefabs/Player/Assets/Visuals/Box.glb" id="1_svjbf"]
[ext_resource type="PackedScene" uid="uid://b2v0yvmmqkpm1" path="res://Prefabs/Player/Assets/Visuals/Gift.glb" id="2_6eu08"]
[ext_resource type="Material" uid="uid://c36inkrjx5b2k" path="res://Materials/Box_Shader.tres" id="3_xyqwj"]
[ext_resource type="Script" uid="uid://db2vhp0gbat8i" path="res://Prefabs/Player/Scripts/MorphMachine/morph_machine.gd" id="4_e341d"]
[ext_resource type="PackedScene" uid="uid://3dq04xvsm1uj" path="res://Prefabs/Player/Assets/Visuals/Letter.glb" id="5_ascna"]
[ext_resource type="Script" uid="uid://cnkvow04mdrs7" path="res://Prefabs/Player/Scripts/MorphMachine/Box/box_morph.gd" id="5_dtuc5"]
[ext_resource type="Shape3D" uid="uid://wlwxj8nlmtw6" path="res://Prefabs/Player/Assets/Collisions/GiftCollision.tres" id="6_6eu08"]
[ext_resource type="Script" uid="uid://7af62ls0diyo" path="res://Prefabs/Player/Scripts/MorphMachine/Box/gift_morph.gd" id="6_bjvkh"]
[ext_resource type="Script" uid="uid://8v7sv1g0hhkf" path="res://Prefabs/Player/Scripts/MovementStates/movement_machine.gd" id="6_rtq3s"]
[ext_resource type="Script" uid="uid://cmytysfbug5lj" path="res://Prefabs/Player/Scripts/MovementStates/Box/BoxIdle.gd" id="7_qb1nn"]
[ext_resource type="Script" uid="uid://c8dnrk3bnoj5t" path="res://Prefabs/Player/Scripts/MorphMachine/Box/letter_morph.gd" id="7_rtq3s"]
[ext_resource type="Script" uid="uid://kdydv3w4vbmf" path="res://Prefabs/Player/Scripts/MovementStates/Box/BoxJump.gd" id="8_xyqwj"]
[ext_resource type="Script" uid="uid://7k55ejrtkrvi" path="res://Prefabs/Player/Scripts/MovementStates/Box/BoxMove.gd" id="9_0coj3"]
[ext_resource type="Script" uid="uid://8ya6m4h5iwym" path="res://Prefabs/Player/Scripts/MovementStates/Gift/GiftIdle.gd" id="12_0coj3"]
[ext_resource type="Script" uid="uid://8l7minnavp8i" path="res://Prefabs/Player/Scripts/MovementStates/Gift/GiftMove.gd" id="13_1eeop"]
[ext_resource type="Script" uid="uid://0mhl8t0suykd" path="res://Prefabs/Player/Scripts/MovementStates/Gift/GiftShoot.gd" id="14_71twl"]
[ext_resource type="Script" uid="uid://d2fh7syuuebu5" path="res://Prefabs/Player/Scripts/MovementStates/Letter/LetterIdle.gd" id="16_np01t"]
[ext_resource type="Script" uid="uid://0nw661rjkhmi" path="res://Prefabs/Player/Scripts/MovementStates/Letter/LetterMove.gd" id="17_j70nv"]
[ext_resource type="Script" uid="uid://6lyad2mri7xi" path="res://Prefabs/Player/Scripts/MovementStates/Letter/LetterShoot.gd" id="18_nv43c"]
[ext_resource type="Shader" uid="uid://chr20l13rdm7l" path="res://addons/flexible_toon_shader/flexible_toon.gdshader" id="19_nv43c"]
[ext_resource type="Shape3D" uid="uid://fqydt82oflel" path="res://Prefabs/Player/Assets/Collisions/LetterCollision.tres" id="21_ascna"]

[sub_resource type="Animation" id="Animation_npgmu"]
resource_name = "Box_Morph"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("PlayerCollision:shape")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("6_6eu08")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("PlayerCollision:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, -0.001, 0)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("MorphVisuals/Gift:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("MorphVisuals/Letter:visible")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("MorphVisuals/Box:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_6eu08"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("PlayerCollision:shape")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("6_6eu08")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("PlayerCollision:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, -0.001, 0)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Visuals/Poof/Smoke:emitting")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("MorphVisuals/Gift:visible")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("MorphVisuals/Letter:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("MorphVisuals/Box:visible")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_ascna"]
resource_name = "Gift_Morph"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("PlayerCollision:shape")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("6_6eu08")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("PlayerCollision:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, -0.001, 0)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("MorphVisuals/Box:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("MorphVisuals/Letter:visible")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("MorphVisuals/Gift:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="Animation" id="Animation_mkw1h"]
resource_name = "Letter_Morph"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("PlayerCollision:shape")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [ExtResource("21_ascna")]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("PlayerCollision:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, -0.001, 0)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Visuals/Poof/Smoke:emitting")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("MorphVisuals/Gift:visible")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("MorphVisuals/Box:visible")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("MorphVisuals/Letter:visible")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_ascna"]
_data = {
&"Box_Morph": SubResource("Animation_npgmu"),
&"Gift_Morph": SubResource("Animation_ascna"),
&"Letter_Morph": SubResource("Animation_mkw1h"),
&"RESET": SubResource("Animation_6eu08")
}

[sub_resource type="Curve" id="Curve_mkw1h"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.229508, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_8ywtt"]
curve = SubResource("Curve_mkw1h")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_su2nr"]
emission_shape = 1
emission_sphere_radius = 1.0
direction = Vector3(0, -1, 0)
spread = 90.0
initial_velocity_min = 2.0
initial_velocity_max = 4.0
gravity = Vector3(0, 2.5, 0)
scale_min = 0.25
scale_max = 1.05
scale_curve = SubResource("CurveTexture_8ywtt")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ij2h7"]
render_priority = 0
shader = ExtResource("19_nv43c")
shader_parameter/albedo = Color(0.945098, 1, 1, 1)
shader_parameter/use_triplanar = true
shader_parameter/clamp_diffuse_to_max = false
shader_parameter/cuts = 3
shader_parameter/wrap = 0.0
shader_parameter/steepness = 1.0
shader_parameter/use_attenuation = true
shader_parameter/use_specular = false
shader_parameter/specular_strength = 1.0
shader_parameter/specular_shininess = 16.0
shader_parameter/use_rim = false
shader_parameter/rim_width = 8.0
shader_parameter/rim_color = Color(1, 1, 1, 1)
shader_parameter/use_ramp = false
shader_parameter/use_borders = false
shader_parameter/border_width = 0.01
shader_parameter/uv1_scale = Vector3(1, 1, 1)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/uv1_blend_sharpness = 32.0

[sub_resource type="SphereMesh" id="SphereMesh_7fswp"]
material = SubResource("ShaderMaterial_ij2h7")
radial_segments = 8
rings = 4

[node name="Player3D" type="RigidBody3D"]
continuous_cd = true
script = ExtResource("1_nld07")

[node name="MorphVisuals" type="Node3D" parent="."]

[node name="Gift" parent="MorphVisuals" instance=ExtResource("2_6eu08")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.183418, 0)
visible = false

[node name="Box" parent="MorphVisuals" instance=ExtResource("1_svjbf")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.15, 0)

[node name="Box_Inside_Flap1" parent="MorphVisuals/Box" index="0"]
surface_material_override/0 = ExtResource("3_xyqwj")

[node name="Box_Inside_Flap2" parent="MorphVisuals/Box" index="1"]
surface_material_override/0 = ExtResource("3_xyqwj")

[node name="Box_Outside_Flap1" parent="MorphVisuals/Box" index="2"]
surface_material_override/0 = ExtResource("3_xyqwj")

[node name="Box_Outside_Flap2" parent="MorphVisuals/Box" index="3"]
surface_material_override/0 = ExtResource("3_xyqwj")

[node name="Box_Body" parent="MorphVisuals/Box" index="4"]
surface_material_override/0 = ExtResource("3_xyqwj")

[node name="Letter" parent="MorphVisuals" instance=ExtResource("5_ascna")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00894929, 0.00414951, 0)
visible = false

[node name="PlayerCollision" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.001, 0)
shape = ExtResource("6_6eu08")

[node name="MorphMachine" type="Node" parent="." node_paths=PackedStringArray("starting_morph")]
script = ExtResource("4_e341d")
starting_morph = NodePath("BoxMorph")

[node name="BoxMorph" type="Node" parent="MorphMachine" node_paths=PackedStringArray("Gift", "Letter")]
script = ExtResource("5_dtuc5")
Gift = NodePath("../GiftMorph")
Letter = NodePath("../LetterMorph")

[node name="MovementMachine" type="Node" parent="MorphMachine/BoxMorph" node_paths=PackedStringArray("starting_state")]
script = ExtResource("6_rtq3s")
starting_state = NodePath("BoxIdle")

[node name="BoxMove" type="Node" parent="MorphMachine/BoxMorph/MovementMachine" node_paths=PackedStringArray("BoxJump", "BoxIdle")]
script = ExtResource("9_0coj3")
BoxJump = NodePath("../BoxJump")
BoxIdle = NodePath("../BoxIdle")

[node name="BoxJump" type="Node" parent="MorphMachine/BoxMorph/MovementMachine" node_paths=PackedStringArray("BoxMove", "BoxIdle")]
script = ExtResource("8_xyqwj")
BoxMove = NodePath("../BoxMove")
BoxIdle = NodePath("../BoxIdle")

[node name="BoxIdle" type="Node" parent="MorphMachine/BoxMorph/MovementMachine" node_paths=PackedStringArray("BoxMove", "BoxJump")]
script = ExtResource("7_qb1nn")
BoxMove = NodePath("../BoxMove")
BoxJump = NodePath("../BoxJump")

[node name="GiftMorph" type="Node" parent="MorphMachine" node_paths=PackedStringArray("Box", "Letter")]
script = ExtResource("6_bjvkh")
Box = NodePath("../BoxMorph")
Letter = NodePath("../LetterMorph")

[node name="MovementMachine" type="Node" parent="MorphMachine/GiftMorph" node_paths=PackedStringArray("starting_state")]
script = ExtResource("6_rtq3s")
starting_state = NodePath("GiftIdle")

[node name="GiftIdle" type="Node" parent="MorphMachine/GiftMorph/MovementMachine" node_paths=PackedStringArray("GiftMove", "GiftShoot")]
script = ExtResource("12_0coj3")
GiftMove = NodePath("../GiftMove")
GiftShoot = NodePath("../GiftShoot")

[node name="GiftMove" type="Node" parent="MorphMachine/GiftMorph/MovementMachine" node_paths=PackedStringArray("GiftIdle", "GiftShoot")]
script = ExtResource("13_1eeop")
GiftIdle = NodePath("../GiftIdle")
GiftShoot = NodePath("../GiftShoot")

[node name="GiftShoot" type="Node" parent="MorphMachine/GiftMorph/MovementMachine" node_paths=PackedStringArray("GiftIdle", "GiftMove")]
script = ExtResource("14_71twl")
GiftIdle = NodePath("../GiftIdle")
GiftMove = NodePath("../GiftMove")

[node name="LetterMorph" type="Node" parent="MorphMachine" node_paths=PackedStringArray("Gift", "Box")]
script = ExtResource("7_rtq3s")
Gift = NodePath("../GiftMorph")
Box = NodePath("../BoxMorph")

[node name="MovementMachine" type="Node" parent="MorphMachine/LetterMorph" node_paths=PackedStringArray("starting_state")]
script = ExtResource("6_rtq3s")
starting_state = NodePath("LetterIdle")

[node name="LetterIdle" type="Node" parent="MorphMachine/LetterMorph/MovementMachine" node_paths=PackedStringArray("LetterMove", "LetterFall")]
script = ExtResource("16_np01t")
LetterMove = NodePath("../LetterMove")
LetterFall = NodePath("../LetterFall")

[node name="LetterMove" type="Node" parent="MorphMachine/LetterMorph/MovementMachine" node_paths=PackedStringArray("LetterIdle", "LetterFall")]
script = ExtResource("17_j70nv")
LetterIdle = NodePath("../LetterIdle")
LetterFall = NodePath("../LetterFall")

[node name="LetterFall" type="Node" parent="MorphMachine/LetterMorph/MovementMachine" node_paths=PackedStringArray("LetterIdle", "LetterMove")]
script = ExtResource("18_nv43c")
LetterIdle = NodePath("../LetterIdle")
LetterMove = NodePath("../LetterMove")

[node name="Timers" type="Node" parent="."]

[node name="JumpCD" type="Timer" parent="Timers"]
unique_name_in_owner = true
wait_time = 5.0
one_shot = true

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_ascna")
}

[node name="Visuals" type="Node3D" parent="."]

[node name="Poof" type="Node3D" parent="Visuals"]

[node name="Smoke" type="GPUParticles3D" parent="Visuals/Poof"]
unique_name_in_owner = true
transform = Transform3D(0.34, 0, 0, 0, 0.34, 0, 0, 0, 0.34, 0, 0, 0)
emitting = false
amount = 12
one_shot = true
explosiveness = 1.0
fixed_fps = 60
process_material = SubResource("ParticleProcessMaterial_su2nr")
draw_pass_1 = SubResource("SphereMesh_7fswp")

[connection signal="timeout" from="Timers/JumpCD" to="MorphMachine/BoxMorph/MovementMachine/BoxJump" method="_on_jump_cd_timeout"]

[editable path="MorphVisuals/Box"]
